<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카밍 - 완전한 출퇴근 관리 경험</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kakao-yellow': '#fef01b',
                        'kakao-bg': '#9bbbd4',
                        'kakao-text': '#556677',
                        'kakao-chat-bg': '#b2c7da'
                    },
                    fontFamily: {
                        'kakao': ['Apple SD Gothic Neo', 'Malgun Gothic', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', 'sans-serif; 
            background: linear-gradient(to bottom, #b2c7da, #9bbbd4);
        }
        .message-bubble {
            max-width: 75%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }
        .message-other {
            background: white;
            border-radius: 18px 18px 18px 4px;
        }
        .message-user {
            background: #fef01b;
            border-radius: 18px 18px 4px 18px;
            margin-left: auto;
        }
        .message-system {
            background: #f0f8ff;
            border: 1px solid #e0f0ff;
            border-radius: 12px;
            margin: 8px auto;
            max-width: 90%;
        }
        .typing-indicator {
            animation: pulse 1.5s infinite;
        }
        .route-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            margin: 8px 0;
            overflow: hidden;
        }
        .urgent-message {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            animation: urgentPulse 2s infinite;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes urgentPulse {
            0%, 100% { border-color: #fed7d7; }
            50% { border-color: #fc8181; }
        }
        .button-action {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 8px 16px;
            margin: 4px 2px;
            display: inline-block;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }
        .button-action:hover {
            background: #e0e0e0;
        }
        .button-primary {
            background: #fef01b;
            border: 1px solid #e6d600;
        }
        .button-primary:hover {
            background: #e6d600;
        }
        .button-urgent {
            background: #ff6b6b;
            color: white;
            border: 1px solid #ff5252;
        }
        .button-urgent:hover {
            background: #ff5252;
        }
        .time-badge {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .notification-sound {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fef01b;
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            animation: notificationPop 0.5s ease-out;
            z-index: 1000;
        }
        @keyframes notificationPop {
            0% { transform: translateY(-20px) scale(0.8); opacity: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 알림 사운드 표시 -->
    <div id="notification-sound" class="notification-sound hidden">
        🔔 카밍 알림
    </div>

    <!-- 카카오톡 헤더 -->
    <div class="bg-kakao-yellow shadow-sm">
        <div class="max-w-md mx-auto px-4 py-3 flex items-center">
            <button onclick="goBack()" class="mr-3 text-gray-700">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>
            <div class="flex items-center space-x-3 flex-1">
                <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-lg">🤖</span>
                </div>
                <div>
                    <h1 class="font-semibold text-gray-800">카밍</h1>
                    <p class="text-xs text-gray-600" id="calming-status">출퇴근 관리 비서</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <button onclick="showTimeSimulator()" class="text-gray-700 text-xs bg-white bg-opacity-50 px-2 py-1 rounded">
                    ⏰ 시간
                </button>
                <button class="text-gray-700">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 채팅 영역 -->
    <div class="max-w-md mx-auto bg-kakao-chat-bg min-h-screen">
        <div id="chat-container" class="p-4 space-y-3 pb-20">
            <!-- 메시지들이 여기에 추가됩니다 -->
        </div>

        <!-- 입력 영역 -->
        <div class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t p-3">
            <div class="flex items-center space-x-2">
                <button class="text-gray-500">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                </button>
                <input 
                    id="message-input" 
                    type="text" 
                    placeholder="메시지를 입력하세요" 
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-full focus:outline-none focus:border-kakao-yellow"
                    onkeypress="handleKeyPress(event)"
                >
                <button onclick="sendMessage()" class="bg-kakao-yellow text-gray-800 px-4 py-2 rounded-full font-medium hover:bg-yellow-500 transition-colors">
                    전송
                </button>
            </div>
        </div>
    </div>

    <!-- 시간 시뮬레이터 모달 -->
    <div id="time-simulator" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 w-80">
            <h3 class="text-lg font-bold text-gray-800 mb-4">시간 시뮬레이션</h3>
            <div class="space-y-3">
                <button onclick="simulateTime('06:50', 'morning')" class="w-full bg-blue-100 text-blue-800 py-3 px-4 rounded-xl font-medium hover:bg-blue-200 transition-colors">
                    🌅 06:50 - 모닝 브리핑
                </button>
                <button onclick="simulateTime('08:08', 'departure')" class="w-full bg-green-100 text-green-800 py-3 px-4 rounded-xl font-medium hover:bg-green-200 transition-colors">
                    🚀 08:08 - 출발 알림
                </button>
                <button onclick="simulateTime('07:45', 'exception')" class="w-full bg-red-100 text-red-800 py-3 px-4 rounded-xl font-medium hover:bg-red-200 transition-colors">
                    🚨 07:45 - 지하철 지연
                </button>
                <button onclick="simulateTime('07:30', 'weather')" class="w-full bg-orange-100 text-orange-800 py-3 px-4 rounded-xl font-medium hover:bg-orange-200 transition-colors">
                    🌧️ 07:30 - 날씨 긴급상황
                </button>
                <button onclick="simulateTime('17:30', 'evening')" class="w-full bg-purple-100 text-purple-800 py-3 px-4 rounded-xl font-medium hover:bg-purple-200 transition-colors">
                    🌆 17:30 - 퇴근 알림
                </button>
            </div>
            <button onclick="closeTimeSimulator()" class="w-full mt-4 bg-gray-200 text-gray-700 py-2 px-4 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                닫기
            </button>
        </div>
    </div>

    <script>
        let chatContainer = document.getElementById('chat-container');
        let messageInput = document.getElementById('message-input');
        let currentStep = 0;
        let isOnboarded = false;
        let userProfile = {
            name: '김대리',
            homeAddress: '',
            workAddress: '',
            arrivalTime: '',
            allowTracking: false
        };

        // 알림 사운드 표시
        function showNotificationSound() {
            const soundDiv = document.getElementById('notification-sound');
            soundDiv.classList.remove('hidden');
            setTimeout(() => {
                soundDiv.classList.add('hidden');
            }, 2000);
        }

        // 메시지 추가 함수
        function addMessage(content, isUser = false, hasButtons = false, buttons = [], isUrgent = false, isSystem = false) {
            const messageDiv = document.createElement('div');
            let className = `message-bubble p-3 mb-2`;
            
            if (isSystem) {
                className += ' message-system';
            } else if (isUser) {
                className += ' message-user ml-auto';
            } else {
                className += ` message-other ${isUrgent ? 'urgent-message' : ''}`;
            }
            
            messageDiv.className = className;
            
            let messageHTML = `<p class="text-sm ${isSystem ? 'text-blue-800 text-center' : 'text-gray-800'}">${content}</p>`;
            
            if (hasButtons && buttons.length > 0) {
                messageHTML += '<div class="mt-3 space-y-1">';
                buttons.forEach(button => {
                    const buttonClass = button.urgent ? 'button-urgent' : (button.primary ? 'button-primary' : 'button-action');
                    messageHTML += `<button onclick="${button.action}" class="${buttonClass} text-sm">${button.text}</button>`;
                });
                messageHTML += '</div>';
            }
            
            messageDiv.innerHTML = messageHTML;
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // 경로 카드 추가
        function addRouteCard(routes, title = "추천 경로") {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'route-card p-4 mb-2 max-w-xs';
            
            let cardHTML = `<h4 class="font-semibold text-gray-800 mb-3">${title}</h4>`;
            
            routes.forEach((route, index) => {
                const statusColor = route.status === '원활' ? 'text-green-600' : 
                                  route.status === '지연' ? 'text-red-600' : 'text-orange-600';
                
                cardHTML += `
                    <div class="flex items-center justify-between p-3 ${index > 0 ? 'border-t border-gray-100' : ''} ${route.recommended ? 'bg-yellow-50 rounded-lg' : ''}">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 ${route.color} rounded-full flex items-center justify-center">
                                <span class="text-white text-xs font-bold">${route.icon}</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 text-sm">${route.name}</p>
                                <p class="text-xs text-gray-600">${route.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-semibold text-gray-800">${route.time}</div>
                            <div class="text-xs ${statusColor}">${route.status}</div>
                        </div>
                    </div>
                `;
            });
            
            cardHTML += `
                <button onclick="startNavigation()" class="w-full mt-3 bg-kakao-yellow text-gray-800 py-2 px-4 rounded-xl font-medium hover:bg-yellow-500 transition-colors">
                    🗺️ 경로 안내 시작
                </button>
            `;
            
            cardDiv.innerHTML = cardHTML;
            chatContainer.appendChild(cardDiv);
            scrollToBottom();
        }

        // 타이핑 인디케이터
        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message-bubble message-other p-3 mb-2 typing-indicator';
            typingDiv.innerHTML = '<p class="text-sm text-gray-600">카밍이 입력 중...</p>';
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        // 스크롤 하단으로
        function scrollToBottom() {
            setTimeout(() => {
                window.scrollTo(0, document.body.scrollHeight);
            }, 100);
        }

        // 키 입력 처리
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // 메시지 전송
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            messageInput.value = '';
            
            setTimeout(() => {
                handleCalmingResponse(message);
            }, 1000);
        }

        // 카밍 응답 처리
        function handleCalmingResponse(userMessage) {
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                
                if (!isOnboarded && (userMessage.includes('출퇴근') || userMessage.includes('카밍'))) {
                    startOnboarding();
                } else if (isOnboarded) {
                    handleOnboardedResponse(userMessage);
                } else {
                    addMessage('안녕하세요! 출퇴근 관리가 필요하시면 "출퇴근 알려줘"라고 말씀해주세요! 😊');
                }
            }, 2000);
        }

        // 온보딩 완료 후 응답
        function handleOnboardedResponse(message) {
            if (message.includes('알림') || message.includes('브리핑')) {
                addMessage('어떤 알림을 확인해보시겠어요?', false, true, [
                    { text: '🌅 모닝 브리핑', action: 'sendMorningBriefing()', primary: false },
                    { text: '🚀 출발 알림', action: 'sendDepartureAlert()', primary: false },
                    { text: '🚨 긴급 알림', action: 'sendExceptionAlert()', primary: true }
                ]);
            } else if (message.includes('경로') || message.includes('길')) {
                addMessage('현재 교통 상황을 확인해드릴게요!', false);
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2호선 + 도보',
                            description: '강남역 → 회사',
                            time: '42분',
                            status: '원활',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        },
                        {
                            name: '740번 버스',
                            description: '직행',
                            time: '48분',
                            status: '보통',
                            color: 'bg-green-500',
                            icon: '🚌'
                        }
                    ];
                    addRouteCard(routes);
                }, 1000);
            } else {
                addMessage('무엇을 도와드릴까요? 😊', false, true, [
                    { text: '📍 현재 경로 확인', action: 'checkCurrentRoute()', primary: false },
                    { text: '⏰ 알림 설정', action: 'showNotificationSettings()', primary: false },
                    { text: '🗺️ 카카오맵 열기', action: 'openKakaoMap()', primary: true }
                ]);
            }
        }

        // 온보딩 시작
        function startOnboarding() {
            addMessage(`안녕하세요, ${userProfile.name}님! 매일 아침 출근길을 챙겨드리는 비서, 카밍이에요. 😊<br><br>먼저 대리님의 출퇴근 프로필을 만들어볼까요?<br><br>집 주소를 알려주시겠어요?`, false, true, [
                { text: '🏠 주소 검색', action: 'searchHomeAddress()', primary: true }
            ]);
        }

        // 주소 검색
        function searchHomeAddress() {
            const addresses = [
                '서울시 강남구 테헤란로 123',
                '서울시 서초구 서초대로 456', 
                '서울시 송파구 올림픽로 789',
                '서울시 마포구 월드컵북로 321'
            ];
            
            const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
            userProfile.homeAddress = randomAddress;
            
            setTimeout(() => {
                addMessage(`집 주소: ${randomAddress}`, true);
                
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage('좋아요! 이제 회사 주소도 알려주세요.', false, true, [
                            { text: '🏢 회사 주소 검색', action: 'searchWorkAddress()', primary: true }
                        ]);
                    }, 1500);
                }, 500);
            }, 1000);
        }

        function searchWorkAddress() {
            const addresses = [
                '서울시 강남구 역삼로 456',
                '서울시 서초구 강남대로 789', 
                '서울시 중구 세종대로 123'
            ];
            
            const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
            userProfile.workAddress = randomAddress;
            
            setTimeout(() => {
                addMessage(`회사 주소: ${randomAddress}`, true);
                
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage('완벽해요! 마지막으로 회사 도착 희망 시간을 알려주세요.', false, true, [
                            { text: '⏰ 09:00', action: 'setArrivalTime("09:00")', primary: false },
                            { text: '⏰ 09:30', action: 'setArrivalTime("09:30")', primary: true },
                            { text: '⏰ 10:00', action: 'setArrivalTime("10:00")', primary: false }
                        ]);
                    }, 1500);
                }, 500);
            }, 1000);
        }

        // 도착 시간 설정
        function setArrivalTime(time) {
            userProfile.arrivalTime = time;
            addMessage(`도착 희망 시간: ${time}`, true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('좋아요! 마지막으로 한 가지만 더요.<br><br>더 정확한 추천을 위해 이동 패턴 학습에 동의해주시겠어요?', false, true, [
                        { text: '📋 자세한 내용 보기', action: 'showPrivacyDetails()', primary: false },
                        { text: '네, 동의해요', action: 'allowTracking(true)', primary: true },
                        { text: '아니요, 괜찮아요', action: 'allowTracking(false)', primary: false }
                    ]);
                }, 2000);
            }, 500);
        }

        // 개인정보 상세 설명
        function showPrivacyDetails() {
            addMessage('자세한 내용을 알려주세요', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('🔒 개인정보 처리 방침<br><br><strong>수집하는 정보:</strong><br>• 출발/도착 시간 기록<br>• 이용 교통수단 (지하철/버스/도보)<br>• 경로 선택 패턴<br><br><strong>사용 목적:</strong><br>• 개인 맞춤 출발 시간 추천<br>• 교통 상황 예측 정확도 향상<br>• 날씨별 이동 패턴 분석<br><br><strong>보관 및 보호:</strong><br>• 최근 30일간만 보관<br>• 암호화하여 안전하게 저장<br>• 외부 제공 절대 금지<br>• 언제든 삭제 요청 가능', false, true, [
                        { text: '동의하고 시작하기', action: 'allowTracking(true)', primary: true },
                        { text: '학습 없이 사용하기', action: 'allowTracking(false)', primary: false }
                    ]);
                }, 2500);
            }, 500);
        }

        // 패턴 학습 동의 (개인정보 설명 포함)
        function allowTracking(allow) {
            userProfile.allowTracking = allow;
            addMessage(allow ? '네, 좋아요' : '괜찮아요', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    
                    if (allow) {
                        addMessage('🔒 개인정보 보호 안내<br><br>• 수집 정보: 출발/도착 시간, 이용 교통수단<br>• 보관 기간: 최근 30일간<br>• 사용 목적: 개인 맞춤 경로 추천<br>• 외부 제공: 절대 하지 않음<br><br>언제든 설정에서 학습을 중단할 수 있어요.', false, false, [], false, true);
                        
                        setTimeout(() => {
                            completeOnboarding();
                        }, 3000);
                    } else {
                        completeOnboarding();
                    }
                }, 2000);
            }, 500);
        }

        // 온보딩 완료
        function completeOnboarding() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                isOnboarded = true;
                addMessage('✅ 멋진 출퇴근 프로필이 완성되었어요!<br><br>이제부터 제가 매일 아침 챙겨드릴게요.<br><br>상단의 ⏰ 시간 버튼을 눌러서 다양한 시간대의 알림을 체험해보세요!', false, true, [
                    { text: '⏰ 알림 체험하기', action: 'showTimeSimulator()', primary: true },
                    { text: '🗺️ 카카오맵 열기', action: 'openKakaoMap()', primary: false }
                ]);
                
                // 상태 업데이트
                document.getElementById('calming-status').textContent = '활성화됨 • 출퇴근 관리 중';
            }, 1500);
        }

        // 시간 시뮬레이터 표시
        function showTimeSimulator() {
            document.getElementById('time-simulator').classList.remove('hidden');
        }

        function closeTimeSimulator() {
            document.getElementById('time-simulator').classList.add('hidden');
        }

        // 시간별 알림 시뮬레이션
        function simulateTime(time, type) {
            closeTimeSimulator();
            showNotificationSound();
            
            addMessage(`⏰ 시간: ${time}`, false, false, [], false, true);
            
            setTimeout(() => {
                if (type === 'morning') {
                    sendMorningBriefing();
                } else if (type === 'departure') {
                    sendDepartureAlert();
                } else if (type === 'exception') {
                    sendExceptionAlert();
                } else if (type === 'weather') {
                    sendWeatherAlert();
                } else if (type === 'evening') {
                    sendEveningAlert();
                }
            }, 1000);
        }

        // 모닝 브리핑
        function sendMorningBriefing() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage(`☀️ ${userProfile.name}님, 좋은 아침!<br><br>오늘 출근길은 대체로 맑고, 교통도 원활해요.<br><br>회사까지 약 45분 예상됩니다.<br><br>${userProfile.arrivalTime} 정시 도착을 위해 08:15에 출발하시는 걸 추천해요!`);
                
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2호선 + 도보',
                            description: '강남역 → 회사',
                            time: '45분',
                            status: '원활',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes, "오늘의 추천 경로");
                }, 1000);
            }, 2000);
        }

        // 출발 알림
        function sendDepartureAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('🚀 지금 바로 출발하세요!<br><br>오늘도 힘내세요!', false, false, [], false);
                
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2호선 + 도보',
                            description: '강남역 → 회사',
                            time: '42분',
                            status: '원활',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes, "지금 출발 경로");
                }, 1000);
            }, 1500);
        }

        // 긴급 알림 (지하철 지연)
        function sendExceptionAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('🚨 긴급 알림!<br><br>이용하시는 2호선에 신호 문제로 운행이 15분 이상 지연되고 있어요.<br><br>지금 바로 나오셔서 740번 버스를 이용하시면 9시까지 도착 가능해요!', false, true, [
                    { text: '🚌 대안 경로로 안내', action: 'showAlternativeRoute()', urgent: true }
                ], true);
            }, 1500);
        }

        // 날씨 긴급 알림
        function sendWeatherAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('🌧️ 날씨 긴급 알림!<br><br>30분 후부터 강한 비가 예보되어 있어요.<br><br>자동차 대신 지하철 이용을 추천드려요. 도로 정체와 시야 확보가 어려울 수 있습니다.', false, true, [
                    { text: '🚇 지하철 경로로 변경', action: 'showSubwayRoute()', urgent: true },
                    { text: '☔ 우산 챙기기 알림', action: 'setUmbrellaReminder()', primary: false }
                ], true);
            }, 1500);
        }

        // 퇴근 알림
        function sendEveningAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage(`🌆 ${userProfile.name}님, 수고하셨어요!<br><br>퇴근길 교통상황을 확인해드릴게요.<br><br>현재 2호선은 원활하고, 집까지 약 40분 예상됩니다.`);
                
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2호선 + 도보',
                            description: '회사 → 집',
                            time: '40분',
                            status: '원활',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes, "퇴근 경로");
                }, 1000);
            }, 2000);
        }

        // 대안 경로 표시 (버스)
        function showAlternativeRoute() {
            addMessage('대안 경로로 안내해주세요', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('740번 버스 경로로 안내를 시작합니다! 🚌<br><br>버스 정류장까지 도보 3분, 버스 도착 예정 시간 2분 후입니다.');
                    
                    setTimeout(() => {
                        const routes = [
                            {
                                name: '2호선 + 도보',
                                description: '지연 중',
                                time: '57분',
                                status: '지연',
                                color: 'bg-red-500',
                                icon: '2'
                            },
                            {
                                name: '740번 버스',
                                description: '대안 경로',
                                time: '45분',
                                status: '원활',
                                color: 'bg-green-500',
                                icon: '🚌',
                                recommended: true
                            }
                        ];
                        addRouteCard(routes, "경로 비교");
                    }, 1000);
                }, 1500);
            }, 500);
        }

        // 지하철 경로 표시 (날씨 대응)
        function showSubwayRoute() {
            addMessage('지하철 경로로 변경해주세요', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('지하철 경로로 변경했어요! 🚇<br><br>비가 와도 안전하고 정시에 도착할 수 있어요.<br><br>2호선 → 3호선 환승으로 안내드릴게요.');
                    
                    setTimeout(() => {
                        const routes = [
                            {
                                name: '자동차',
                                description: '비로 인한 정체 예상',
                                time: '65분',
                                status: '지연',
                                color: 'bg-red-500',
                                icon: '🚗'
                            },
                            {
                                name: '2호선 → 3호선',
                                description: '지하철 환승',
                                time: '48분',
                                status: '원활',
                                color: 'bg-blue-500',
                                icon: '🚇',
                                recommended: true
                            }
                        ];
                        addRouteCard(routes, "날씨 대응 경로");
                    }, 1000);
                }, 1500);
            }, 500);
        }

        // 우산 알림 설정
        function setUmbrellaReminder() {
            addMessage('우산 챙기기 알림을 설정해주세요', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('☔ 우산 챙기기 알림을 설정했어요!<br><br>출발 10분 전에 "우산 챙기세요!" 알림을 보내드릴게요.<br><br>오늘 강수량은 10-20mm 예상됩니다.');
                }, 1500);
            }, 500);
        }

        // 기타 함수들
        function checkCurrentRoute() {
            addMessage('현재 경로를 확인해주세요', true);
            setTimeout(() => {
                const routes = [
                    {
                        name: '2호선 + 도보',
                        description: '집 → 회사',
                        time: '42분',
                        status: '원활',
                        color: 'bg-blue-500',
                        icon: '2',
                        recommended: true
                    }
                ];
                addRouteCard(routes, "현재 경로 상황");
            }, 1000);
        }

        function showNotificationSettings() {
            addMessage('알림 설정을 확인해주세요', true);
            setTimeout(() => {
                addMessage('현재 알림 설정:<br><br>• 모닝 브리핑: 매일 06:50<br>• 출발 알림: 도착 시간 기준<br>• 긴급 알림: 실시간<br><br>설정을 변경하시겠어요?', false, true, [
                    { text: '⚙️ 설정 변경', action: 'openSettings()', primary: false },
                    { text: '✅ 현재 설정 유지', action: 'keepSettings()', primary: true }
                ]);
            }, 1000);
        }

        function openSettings() {
            addMessage('설정을 변경하겠습니다', true);
            addMessage('설정 변경 기능은 개발 중입니다. 😊');
        }

        function keepSettings() {
            addMessage('현재 설정을 유지하겠습니다', true);
            addMessage('알겠습니다! 현재 설정으로 계속 알림을 보내드릴게요. 😊');
        }

        function startNavigation() {
            addMessage('카카오맵으로 연결됩니다... 🗺️');
        }

        function openKakaoMap() {
            addMessage('카카오맵을 열어볼게요!', true);
            setTimeout(() => {
                addMessage('카카오맵이 열렸습니다! 🗺️<br><br>"내 출근길" 위젯에서 실시간 정보를 확인하세요.');
            }, 1000);
        }

        function goBack() {
            if (confirm('채팅방을 나가시겠습니까?')) {
                window.history.back();
            }
        }

        // 초기 메시지
        function initChat() {
            addMessage('안녕하세요! 저는 출퇴근 관리를 도와드리는 카밍이에요. 😊<br><br>출퇴근 관리가 필요하시면 언제든 말씀해주세요!');
        }

        // 페이지 로드시 초기화
        window.onload = function() {
            initChat();
            messageInput.focus();
        };
    </script>
</body>
</html>
